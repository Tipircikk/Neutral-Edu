
{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true",
        ".write": "$uid === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true"
      }
    },
    "coupons": {
      // Admins can read and write all coupons
      ".read": "root.child('users').child(auth.uid).child('isAdmin').val() === true",
      ".write": "root.child('users').child(auth.uid).child('isAdmin').val() === true",
      "$couponId": {
        // Allow users to read a specific coupon if they are trying to redeem it (future enhancement if needed)
        // For now, keep it simple, only admins for general R/W
      }
    },
    "pricingConfig": {
      "currentPrices": {
        ".read": "auth != null", // Allow all authenticated users to read prices
        ".write": "root.child('users').child(auth.uid).child('isAdmin').val() === true" // Only admins can write
      }
    },
    "appConfig": {
       "examDates": {
          ".read": "auth != null", // Allow all authenticated users to read exam dates
         ".write": "root.child('users').child(auth.uid).child('isAdmin').val() === true" // Only admins can write
       }
    },
    "supportTickets": {
        "$ticketId": {
            // User can read/write their own ticket, admin can read/write any ticket
            ".read": "data.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true",
            ".write": "(newData.child('userId').val() === auth.uid && (data.exists() ? data.child('userId').val() === auth.uid : true)) || root.child('users').child(auth.uid).child('isAdmin').val() === true",
            "messages": {
                "$messageId": {
                    // User can read messages for their own ticket, admin can read any
                    ".read": "root.child('supportTickets').child($ticketId).child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true",
                    // User can write messages to their own ticket (if senderId matches and type is user)
                    // Admin can write messages to any ticket (if senderId matches and type is admin)
                    ".write": "(newData.child('senderId').val() === auth.uid && newData.child('senderType').val() === 'user' && root.child('supportTickets').child($ticketId).child('userId').val() === auth.uid) || (newData.child('senderId').val() === auth.uid && newData.child('senderType').val() === 'admin' && root.child('users').child(auth.uid).child('isAdmin').val() === true)"
                }
            }
        }
    },
    ".read": false,
    ".write": false
  }
}
    